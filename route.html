<!DOCTYPE html>
<html>
	<head>
 		<title>Find me a route | route1</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link href="css/style.css" rel="stylesheet" type="text/css"/>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
		<link rel="stylesheet" href="css/leaflet-routing-machine.css" />

  		<style>
			body {
			    padding: 0;
			    margin: 0;
			}
			html, body, #map {
			    height: 100%;
			}
			#map {
			    height: 90%;
			}
			.header {
				height: 10%
			}
			.wrap{
				padding-top: 15px;
			}
			.menu{
				padding: 5px;
			}
			menu li a:hover, .menu li.active a {

				box-shadow: inset 0px 0px 5px rgba(207, 201, 201, 0.88);
			}
			@media all and (min-width: 100px) and (max-width: 700px) {
				.header {
					height: 10%;
					min-height: 50px
				}
				.wrap{
					padding-top: 5px;
				}
				.menu{
					padding: 5px;
				}	
			}

		</style>
	</head>
	<body>
	  	<div class="header">
		 	<div class="wrap">
			 	<div class="header_top">

					<div class="menu">
					    <ul>
							<li><a href="index.html">Home</a></li>
							<li class="active"><a href="route.html">Map</a></li>
							<li><a href="#">Download</a></li>
							<li><a href="#">Contact</a></li>
							<div class="clear"></div>
						</ul>
					</div>							
		    		<div class="clear"></div>
		        </div>
		    </div>
		</div>	
		<div id="map"></div>
		<img id="getLocationButton" title="getLocation" style="position: absolute; bottom: 22px;left:18px;height:35px; z-index: 99;cursor: pointer" src="images/map-marker.png" onclick="getLocation()">
		<p style="position: absolute; bottom: 5px;left:5px; z-index: 99;">Find me</p>
		
		<img id="routeButton" title="getLocation" style="position: absolute; bottom: 22px;left:87px;height:35px; z-index: 99;cursor: pointer" src="images/map-icon.png" onclick="getRoute()">
		<p style="position: absolute; bottom: 5px;left:72px; z-index: 99;">Find route</p>
	</body>
	<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
	<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
	
	<script src="js/leaflet-routing-machine.min.js"></script>
<!-- 
	<script src="js/pastLocs.js"></script>

 -->
	<script type="text/javascript">
		var destination = location.hash;
		
		var destino= new L.LatLng( 42.35012852672134, -3.6893033981323238 );
		var destinolat, destinolon;
		var mylat,mylon;//user location


		var routeButton = $("#routeButton");
		var getLocationButton = $("#getLocationButton");

		var map = L.map('map');

		if (destination==="#formigal") {
			destino= new L.LatLng( 42.775103164773554, -0.359228253364563 );
			destinolat=42.775103164773554;
			destinolon=-0.359228253364563;

		};
		if (destination==="#frula") {
			destino= new L.LatLng( 41.9107301192092, -0.44824004173278803 );
			destinolat= 41.9107301192092;
			destinolon= -0.44824004173278803;
		};
		if (destination==="#burgos") {
			destino= new L.LatLng( 42.35012852672134, -3.6893033981323238 );
			destinolat= 42.35012852672134;
			destinolon= -3.6893033981323238;
		};	
		var marker = L.marker(destino).addTo(map);
		map.setView(destino, 13);

		//create base maps layers
		var osmlayer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
		  maxZoom: 18,
		  attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
		});
	
		var Sat = L.tileLayer( 'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
			attribution: 'Map tiles by Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community.'
		});

		var baseLayers = {
		  "osm": osmlayer,
		  "Sat":Sat
		};

		L.control.layers(baseLayers).addTo(map);
		  osmlayer.addTo(map);
	
		// find user position
		function getLocation()  {
			var options = null;
		  	if (navigator.geolocation) {
		    	options={enableHighAccuracy: true, maximumAge: 3000, timeout: 30000};
				navigator.geolocation.getCurrentPosition(showPosition,getNoPosition,options);
		  	}
		  	else {
		  		alert("Geolocation is not supported by this browser.");
		  	}
		};


		function showPosition(position) {
			mylat = position.coords.latitude;
			mylon = position.coords.longitude;
			accu= position.coords.accuracy;
			console.log(mylat+'/'+mylon)
			var myPosition = new L.LatLng(mylat, mylon);
			//var centerlat= +lat;
			//centerlat= centerlat+0.0005
			map.setView(myPosition, 16);

			//var distance2car= getDistanceFromLatLonInKm(mylat, mylon, carlat, carlon);

			var myPosition= L.marker(myPosition).addTo(map);
			myPosition.bindPopup("You are within " + accu.round(2) + "m from here").openPopup();
			accu=accu/2;
			console.log('olakease'+' '+myPosition+' '+accu)

			//L.circle(myPosition, accu).addTo(map);
			console.log('olakease')
			//routeButton.removeClass( "hide" );
			//getLocationButton.addClass("hide");
			//texto.addClass("hide");
		}

		function getNoPosition(position) {
			//map.setView([41.3905, 2.1914], 15);
			alert("Geolocation is not supported")
		};

		// find route with leaflet-routing-machine.js
		function getRoute() {

			if (mylat == undefined) {
				getLocation();
			}
			alert('getroute from: '+mylat+'-'+mylon+'to '+destinolat+' '+destinolon)

			L.Routing.control({
			    waypoints: [
			        L.latLng(mylat,mylon),
			        L.latLng(destinolat,destinolon)
			    ]
			}).addTo(map);
		};

		//dist
		map.on('click', function(e) {
		    console.log("Lat, Lon : " + e.latlng.lat + ", " + e.latlng.lng)
		});
		
		Number.prototype.round = function(places) {
		 	return +(Math.round(this + "e+" + places)  + "e-" + places);
		}
		
	</script>
  

</html>